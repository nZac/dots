#!/usr/bin/env zsh


function install_vim() {

    if ! brew list | grep vim 2>&1 > /dev/null ; then
        brew install vim
    fi

    if ! ls $HOME/Library/Fonts | grep "Source Code" 2>&1 > /dev/null ; then
        $HOME/.dotfiles/fonts/install.sh
    fi

    if [ "$(brew list | grep ctags)" != "ctags" ]; then
        brew install ctags
    fi

    if [ "$(brew list | grep cmake)" != "cmake" ]; then
        # This is needed for YouCompleteMe
        brew install cmake
    fi

    last_update_file="$HOME/.vim/vim-plugin-updates"
    if [ ! -e $last_update_file ]; then
        touch $last_update_file
    fi

    if [ $(gstat --format=%Y $last_update_file) -le $(( `date +%s` - 1800 )) ]; then
        vim +PlugInstall +qall tmpbuf
        vim +PlugUpdate +qall tmpbuf
        touch $last_update_file
    fi

    stow vim
}

function install_zsh() {
    stow zsh

    if ! $(command -v gls 2>&1 > /dev/null); then
        brew install coreutils
    fi

    if ! $(command -v grc 2>&1 > /dev/null); then
        brew install grc
    fi
}

function install_tmux() {

    if ! $(command -v tmux 2>&1 > /dev/null); then
        good "Install TMUX..."
        brew install tmux
        brew install reattach-to-user-namespace
    fi

    stow tmux
}

function install_python_env() {

    if ! $(command -v pyenv 2>&1 > /dev/null); then
        good "Install pyenv..."

        # PyEnv Install Script
        curl -L https://git.io/v9ZtW | bash
    fi
}

functions setup_dev_env() {
    install_python_env

    # Main Projects Directory
    mkdir -p $HOME/j
    cat <<EOF > $HOME/.ssh/config
Host *
    IdentityFile ~/.ssh/id_rsa
    AddKeysToAgent yes
EOF


}

functions setup_git() {
    if [ ! -f ~/.gitconfig ]; then
        echo "Configuring Git for this machine"

        stow git

        echo -n "Enter your name and press [ENTER]: "
        read name
        git config --global user.name "$name"

        echo -n "Enter your email and press [ENTER]: "
        read email
        git config --global user.email "$email"

        git config --global core.excludesfile "~/.gitignore_global"
    else
        echo "Git is setup as $(git config --global user.name) <$(git config --global user.email)>"
    fi
}

function run() {
    install_zsh
    install_vim
    install_tmux
    setup_dev_env
    setup_git
}

run
